% my $columns = [schema->source($table)->columns];
% my $order = source_id($table);
% my $result = schema->resultset($table)->single({$order => $id});
% my $columns_info = schema->source($table)->columns_info($columns);

<form class="form-horizontal" action="/admin/save/<%= $table %>" method="post">
  % for my $column (@$columns) {
      % my $required = $columns_info->{$column}->{is_nullable} ? '' : 'required';
  <fieldset>
    <div class="control-group">
      <label class="control-label-left" for="<%= $column %>"><%= l $column %> 
      % if ($required) {
        <span class="required" title="<%= l 'required field' %>">*</span>
      % }
      </label>
      
      % my $col_base = $column;
      % $col_base =~ s/_id$//;
      % if (schema->source($table)->_relationships->{$col_base} ) {

      <select name="<%= $column %>" id="<%= $column %>" class="<%= $required %>" <%= $required %> >
        % my $rel_class = schema->source($table)->_relationships->{$col_base}->{class};
        % $rel_class =~ s/^.*::([a-zA-Z_]+)$/$1/;
        % my $rel_result = schema->resultset($rel_class)->search;
        % my $rel_order = source_id($rel_class);
           
        % while ( my $rel_record = $rel_result->next ) {        
          % if ($result && $result->$column eq $rel_record->$rel_order ) {
        <option selected="selected" value="<%= $result->$column %>"><%= $rel_record->name %></option>
          % }
          % else {
        <option value="<%= $rel_record->$rel_order %>"><%= $rel_record->name %></option>
          % }          
        % }             
      </select> 

      % }
      % elsif ($columns_info->{$column}->{data_type} =~ m/tinyint/) {
        % my $checked = $result->$column ? 'checked="checked"' : ''; 
      <div class="controls"> 
        <input class="type-check" id="<%= $column %>" name="<%= $column %>"
          % my $placeholder = $result ? $result->$column : 0;
               type="checkbox"   <%= $checked %>>
      </div>
      % }     
      % else {
      <div class="controls">
        <input class="input-xlarge" id="<%= $column %>" name="<%= $column %>"
          % my $placeholder = $result ? $result->$column : '';
               type="text"  value="<%= $placeholder %>" <%= $required %>>
      </div>
      % }
    </div>
  </fieldset>
  % }

  <div class="control-group">
    <div class="controls">
      <div class="float_right">
        <button type="submit" class="btn btn-primary"><%= l 'store' %> â–¶</button>
      </div>
    </div>
  </div>
</form>
